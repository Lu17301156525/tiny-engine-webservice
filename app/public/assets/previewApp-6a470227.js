import{w as b,I as k,a$ as h}from"./index-11692c7d.js";import{ref as i,onMounted as A,resolveComponent as y,openBlock as N,createElementBlock as O,createElementVNode as m,createVNode as R,toDisplayString as P,createBlock as x,withCtx as B,createTextVNode as C,createCommentVNode as $,pushScopeId as L,popScopeId as U,createApp as G}from"vue";import{Progress as V,Button as D}from"@opentiny/vue";import{_ as M}from"./_plugin-vue_export-helper-c27b6911.js";import"./vendor-6a2a38e0.js";import"./monaco-73815df4.js";import"prettier";import"prettier/parser-html";import"prettier/parser-postcss";import"prettier/parser-babel";import"@opentiny/vue-icon";import"@opentiny/vue-locale";const F={TYPE:{CONSOLE:"console",MOBILE:"mobile",BUG_SCREEN:"bigScreen",PRICE_CALCULATOR:"priceCalculator",TAIHU:"taihu",COMMON:"common"}};const H={components:{TinyProgress:V,TinyButton:D},setup(){const a=b(),l=new URLSearchParams(location.search),c=l.get("appid"),o=3e3,t=i(0),p=i("exception"),n=i(!1),r={RUNNING:1,STOPPED:2,FINISHED:3},u={1:"正在构建中...",2:"构建失败，请重新构建",3:"构建完成"},_=i(u[1]),w=()=>{t.value>=90||(t.value>=50&&t.value<75?p.value="warning":t.value>=75&&(p.value="success"),t.value+=2)},d=e=>{e&&(w(),a.get(`/app-center/api/tasks/status/${e}`).then(v=>{if(_.value=u[v.taskStatus],v.taskStatus===r.RUNNING)setTimeout(()=>{d(e)},o);else if(v.taskStatus===r.FINISHED){p.value="success",t.value=100;let I=`${h}/app-center/entry/${c}/`;const{appInfoState:g,updateApp:T}=k();T(c).then(()=>{var f;const s=((f=g.selectedApp)==null?void 0:f.extend_config)||{};(s==null?void 0:s.app_type)===F.TYPE.CONSOLE&&(I=`${h}/app-service/${(s==null?void 0:s.app_type)??(s==null?void 0:s.type)}${s.business.router}?appId=${c}&region=cn-north-7&previewType=app&env=alpha&tenant=${l.get("tenant")}`)}).finally(()=>{window.location=I})}else p.value="exception",t.value=0,n.value=!0}))},S=()=>{a.get(`/app-center/api/apps/preview/${c}`).then(e=>{(e.taskId||e.id)&&setTimeout(()=>{d(e.taskId||e.id)},o)}).catch(e=>{p.value="exception",t.value=0,n.value=!0,_.value=(e==null?void 0:e.message)||u[2]})},E=()=>{n.value=!1,p.value="exception",t.value=0,S()};return A(S),{statusText:_,percentage:t,progressStatus:p,isBtnShow:n,rebuildApp:E}}},Y=a=>(L("data-v-53123abf"),a=a(),U(),a),X={class:"preview-box"},j={class:"preview"},q=Y(()=>m("div",{class:"preview-title"}," 温馨提示：预览页面默认打开的是根路由对应的页面，如果没有配置根路由页面，则需要补全URL后面的路由 ",-1));function z(a,l,c,o,t,p){const n=y("tiny-progress"),r=y("tiny-button");return N(),O("div",X,[m("div",j,[q,R(n,{class:"progress","text-inside":!0,"stroke-width":30,percentage:o.percentage,status:o.progressStatus},null,8,["percentage","status"]),m("div",null,P(o.statusText),1),o.isBtnShow?(N(),x(r,{key:0,class:"preview-btn",type:"primary",onClick:o.rebuildApp},{default:B(()=>[C("重新构建")]),_:1},8,["onClick"])):$("",!0)])])}const J=M(H,[["render",z],["__scopeId","data-v-53123abf"]]);G(J).mount("#app");
